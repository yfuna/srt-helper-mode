(require 'ert)
(require 'srt-helper-test)

(ert-deftest test/srt-helper-search-forward ()
  (srt-helper-test-in-example-file-2
   "short-sample.1.srt"
   (goto-char (point-min))
   (srt-helper-search-forward "14")
   (should (equal (buffer-substring-no-properties (point) (+ (point) 12))
		  "00:00:14,812"))))

(ert-deftest test/srt-helper-search-forward/complicated ()
  (srt-helper-test-in-example-file-2
      "Romeo and Juliet (1936).1.srt"
      (goto-char (point-min))
      (srt-helper-search-forward "14:00")
      (should (equal (buffer-substring-no-properties (point) (+ (point) 12))
		     "00:13:58,000"))
      (srt-helper-search-forward "23:34")
      (should (equal (buffer-substring-no-properties (point) (+ (point) 12))
		     "00:23:34,600"))))

(ert-deftest test/srt-helper--timestamp-to-ms ()
  (should (equal (srt-helper--timestamp-to-ms "00:00:00,000")
		 0))
  (should (equal (srt-helper--timestamp-to-ms "00:00:00,001")
		 1))
  (should (equal (srt-helper--timestamp-to-ms "00:00:00,123")
		 123))
  (should (equal (srt-helper--timestamp-to-ms "00:00:12,345")
		 12345))
  (should (equal (srt-helper--timestamp-to-ms "00:12:34,567")
		 754567))
  (should (equal (srt-helper--timestamp-to-ms "12:34:56,789")
		 45296789)))

(ert-deftest test/srt-helper--ms-to-timestamp ()
  (should (equal (srt-helper--ms-to-timestamp 0)
		 "00:00:00,000"))
  (should (equal (srt-helper--ms-to-timestamp 1)
		 "00:00:00,001"))
  (should (equal (srt-helper--ms-to-timestamp 123)
		 "00:00:00,123"))
  (should (equal (srt-helper--ms-to-timestamp 12345)
		 "00:00:12,345"))
  (should (equal (srt-helper--ms-to-timestamp 754567)
		 "00:12:34,567"))
  (should (equal (srt-helper--ms-to-timestamp 45296789)
		 "12:34:56,789")))

(ert-deftest test/srt-helper--interpret-maybe-timestamp ()
  (should (equal (srt-helper--interpret-maybe-timestamp "0:16")
		 (srt-helper--timestamp-to-ms "00:00:16,000")))
  (should (equal (srt-helper--interpret-maybe-timestamp "0:0:16")
		 (srt-helper--timestamp-to-ms "00:00:16,000")))
  (should (equal (srt-helper--interpret-maybe-timestamp "4:16")
		 (srt-helper--timestamp-to-ms "00:04:16,000")))
  (should (equal (srt-helper--interpret-maybe-timestamp "1:4:16")
		 (srt-helper--timestamp-to-ms "01:04:16,000")))
  (should (equal (srt-helper--interpret-maybe-timestamp "60:16")
		 (srt-helper--timestamp-to-ms "01:00:16,000")))
  (should (equal (srt-helper--interpret-maybe-timestamp "12:34,567")
		 (srt-helper--timestamp-to-ms "00:12:34,567")))
  (should (equal (srt-helper--interpret-maybe-timestamp "12:34.567")
		 (srt-helper--timestamp-to-ms "00:12:34,567"))))

(ert-deftest test/srt-helper--maybe-time ()
  (should (equal (srt-helper--maybe-time "4:16")
		 (srt-helper--timestamp-to-ms "00:04:16,000")))
  (should (equal (srt-helper--maybe-time "180")
		 (srt-helper--timestamp-to-ms "00:03:00,000"))))
